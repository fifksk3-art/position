<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì „ìˆ  ë¶„ì„ í”„ë¡œ - ìµœì¢…ë³¸</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root { --pitch-green: #2e7d32; --line: rgba(255,255,255,0.6); --select-glow: 0 0 15px 5px #ffeb3b; }
        body { font-family: -apple-system, sans-serif; margin: 0; background: #121212; color: white; display: flex; flex-direction: column; align-items: center; }
        
        .header { width: 100%; background: #222; padding: 12px; display: flex; justify-content: center; align-items: center; gap: 15px; position: sticky; top: 0; z-index: 1000; }
        .main-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 25px; padding: 20px; }
        
        .board-section { background: #252525; padding: 15px; border-radius: 12px; display: flex; flex-direction: column; align-items: center; width: 390px; border: 1px solid #333; }
        .controls { width: 100%; display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
        .row { display: flex; gap: 4px; justify-content: center; align-items: center; flex-wrap: wrap; }
        
        input, select, button { padding: 6px; border: 1px solid #444; border-radius: 5px; font-size: 12px; background: #333; color: white; }
        button { cursor: pointer; border: none; font-weight: bold; transition: 0.2s; }
        button:active { transform: scale(0.95); }
        
        .btn-blue { background: #1a73e8; } .btn-orange { background: #ff9800; color: black; } .btn-red { background: #d93025; } 
        .btn-green { background: #34a853; flex: 1; } 
        .btn-save-data { background: #673ab7; width: 100%; margin-top: 5px; padding: 8px; font-size: 13px; }
        .btn-capture { background: #009688; width: 100%; margin-top: 3px; padding: 8px; font-size: 13px; }

        /* ê²½ê¸°ì¥ ì˜ì—­ */
        .pitch-wrapper { position: relative; padding: 10px; background: #252525; border-radius: 5px; }
        .pitch {
            width: 370px; height: 500px; background-color: var(--pitch-green);
            position: relative; border: 2px solid white; border-radius: 3px; overflow: hidden; touch-action: none;
        }
        /* ì”ë”” íŒ¨í„´ */
        .pitch.pattern-grid { background-image: linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px); background-size: 40px 40px; }
        .pitch.pattern-stripe { background-image: linear-gradient(rgba(0,0,0,0.08) 50%, transparent 50%); background-size: 100% 10%; }

        .pitch-line { position: absolute; border: 1.2px solid var(--line); pointer-events: none; }
        .center-circle { width: 70px; height: 70px; border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .half-line { width: 100%; top: 50%; }
        .penalty-box { width: 45%; height: 14%; left: 27.5%; }
        .top-box { top: 0; border-top: none; } .bottom-box { bottom: 0; border-bottom: none; }

        /* ì„ ìˆ˜ ì•„ì´ì½˜ */
        .player { width: 60px; position: absolute; display: flex; flex-direction: column; align-items: center; z-index: 50; }
        .player-icon { 
            width: 32px; height: 32px; border-radius: 50%; border: 2px solid white; 
            display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 10px;
            box-shadow: 0 3px 5px rgba(0,0,0,0.3); color: white;
        }
        .player.selected .player-icon { box-shadow: var(--select-glow); border-color: #ffeb3b; transform: scale(1.1); }
        .player-name { background: rgba(0,0,0,0.75); color: white; font-size: 11px; padding: 2px 5px; border-radius: 3px; margin-top: 3px; white-space: nowrap; }

        @media (max-width: 450px) { .board-section { width: 95vw; } .pitch { width: 88vw; height: 120vw; } }
    </style>
</head>
<body>

<div class="header">
    <strong>ğŸŸï¸ ìŠ¤íƒ€ì¼:</strong>
    <select id="pitchPattern" onchange="changePattern(this.value)">
        <option value="">ê¸°ë³¸ ì”ë””</option>
        <option value="pattern-grid">ê²©ìë¬´ëŠ¬</option>
        <option value="pattern-stripe">ê°€ë¡œì¤„ë¬´ëŠ¬</option>
    </select>
    <div style="font-size: 11px; color: #aaa; margin-left: 10px; line-height: 1.2;">
        ì„ ìˆ˜ ì„ íƒ í›„ [ìˆ˜ì •/ì‚­ì œ] ê°€ëŠ¥<br>[ìŠ¤ì¿¼ë“œ ì €ì¥] ì‹œ ë¸Œë¼ìš°ì €ì— ìœ ì§€
    </div>
</div>

<div class="main-container">
    <div class="board-section" id="section-h">
        <h3 style="color:#4285f4; margin:0 0 10px 0;">HOME SQUAD</h3>
        <div class="controls">
            <div class="row">
                <input type="text" id="name-h" placeholder="ì´ë¦„" style="width:65px;">
                <select id="pos-h" style="width:55px;">
                    <option value="FW">FW</option><option value="MF">MF</option>
                    <option value="DF">DF</option><option value="GK">GK</option>
                </select>
                <input type="color" id="color-h" value="#4285f4" style="width:30px; padding:2px;">
                <button class="btn-blue" onclick="addPlayer('h')">ì¶”ê°€</button>
            </div>
            <div class="row">
                <button class="btn-orange" onclick="editPlayer('h')">ì´ë¦„ìˆ˜ì •</button>
                <button class="btn-red" onclick="deletePlayer('h')">ì„ ìˆ˜ì‚­ì œ</button>
                <button class="btn-red" onclick="clearPitch('h')" style="background:#555;">ë¦¬ì…‹</button>
            </div>
            <div class="row">
                <button class="btn-green" onclick="applyFormation('h','442')">4-4-2</button>
                <button class="btn-green" onclick="applyFormation('h','433')">4-3-3</button>
                <button class="btn-green" onclick="applyFormation('h','4231')">4-2-3-1</button>
            </div>
            <button class="btn-save-data" onclick="saveSquad('h')">ğŸ’¾ HOME ìŠ¤ì¿¼ë“œ ì €ì¥</button>
            <button class="btn-capture" onclick="captureBoard('capture-h', 'home-tactic')">ğŸ“¸ HOME ì´ë¯¸ì§€ ì €ì¥</button>
        </div>
        <div id="capture-h" class="pitch-wrapper">
            <div id="pitch-h" class="pitch">
                <div class="pitch-line half-line"></div><div class="pitch-line center-circle"></div>
                <div class="pitch-line penalty-box top-box"></div><div class="pitch-line penalty-box bottom-box"></div>
            </div>
        </div>
    </div>

    <div class="board-section" id="section-a">
        <h3 style="color:#ea4335; margin:0 0 10px 0;">AWAY SQUAD</h3>
        <div class="controls">
            <div class="row">
                <input type="text" id="name-a" placeholder="ì´ë¦„" style="width:65px;">
                <select id="pos-a" style="width:55px;">
                    <option value="FW">FW</option><option value="MF">MF</option>
                    <option value="DF">DF</option><option value="GK">GK</option>
                </select>
                <input type="color" id="color-a" value="#ea4335" style="width:30px; padding:2px;">
                <button class="btn-blue" onclick="addPlayer('a')">ì¶”ê°€</button>
            </div>
            <div class="row">
                <button class="btn-orange" onclick="editPlayer('a')">ì´ë¦„ìˆ˜ì •</button>
                <button class="btn-red" onclick="deletePlayer('a')">ì„ ìˆ˜ì‚­ì œ</button>
                <button class="btn-red" onclick="clearPitch('a')" style="background:#555;">ë¦¬ì…‹</button>
            </div>
            <div class="row">
                <button class="btn-green" onclick="applyFormation('a','442')">4-4-2</button>
                <button class="btn-green" onclick="applyFormation('a','433')">4-3-3</button>
                <button class="btn-green" onclick="applyFormation('a','4231')">4-2-3-1</button>
            </div>
            <button class="btn-save-data" onclick="saveSquad('a')">ğŸ’¾ AWAY ìŠ¤ì¿¼ë“œ ì €ì¥</button>
            <button class="btn-capture" onclick="captureBoard('capture-a', 'away-tactic')">ğŸ“¸ AWAY ì´ë¯¸ì§€ ì €ì¥</button>
        </div>
        <div id="capture-a" class="pitch-wrapper">
            <div id="pitch-a" class="pitch">
                <div class="pitch-line half-line"></div><div class="pitch-line center-circle"></div>
                <div class="pitch-line penalty-box top-box"></div><div class="pitch-line penalty-box bottom-box"></div>
            </div>
        </div>
    </div>
</div>

<script>
    let selectedPlayer = null;

    window.onload = () => { loadSquads(); };

    function addPlayer(side, name=null, pos=null, t=45, l=45, color=null) {
        const pitch = document.getElementById(`pitch-${side}`);
        const pName = name || document.getElementById(`name-${side}`).value || "ì„ ìˆ˜";
        const pPos = pos || document.getElementById(`pos-${side}`).value;
        const pColor = color || document.getElementById(`color-${side}`).value;

        const p = document.createElement('div');
        p.className = 'player';
        p.style.top = t + '%'; p.style.left = l + '%';
        p.dataset.side = side;

        p.innerHTML = `<div class="player-icon" style="background-color: ${pColor}">${pPos}</div><div class="player-name">${pName}</div>`;

        p.addEventListener('click', (e) => {
            e.stopPropagation();
            if (selectedPlayer) selectedPlayer.classList.remove('selected');
            selectedPlayer = p;
            p.classList.add('selected');
        });

        initDrag(p, pitch);
        pitch.appendChild(p);
        if(!name) document.getElementById(`name-${side}`).value = '';
    }

    function initDrag(el, pitch) {
        let isDragging = false;
        let offset = { x: 0, y: 0 };
        el.addEventListener('pointerdown', (e) => {
            isDragging = true;
            el.setPointerCapture(e.pointerId);
            const rect = el.getBoundingClientRect();
            offset.x = e.clientX - rect.left;
            offset.y = e.clientY - rect.top;
        });
        el.addEventListener('pointermove', (e) => {
            if (!isDragging) return;
            const pRect = pitch.getBoundingClientRect();
            let x = e.clientX - pRect.left - offset.x;
            let y = e.clientY - pRect.top - offset.y;
            el.style.left = Math.max(0, Math.min(x, pRect.width - 45)) + 'px';
            el.style.top = Math.max(0, Math.min(y, pRect.height - 45)) + 'px';
        });
        el.addEventListener('pointerup', () => isDragging = false);
    }

    function captureBoard(wrapperId, filename) {
        const target = document.getElementById(wrapperId);
        html2canvas(target, { backgroundColor: '#252525' }).then(canvas => {
            const link = document.createElement('a');
            link.download = filename + '.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }

    function saveSquad(side) {
        const squadData = [];
        document.getElementById(`pitch-${side}`).querySelectorAll('.player').forEach(p => {
            squadData.push({
                name: p.querySelector('.player-name').innerText,
                color: p.querySelector('.player-icon').style.backgroundColor,
                top: p.style.top,
                left: p.style.left,
                pos: p.querySelector('.player-icon').innerText
            });
        });
        localStorage.setItem(`squad-${side}`, JSON.stringify(squadData));
        alert(`${side === 'h' ? 'HOME' : 'AWAY'} íŒ€ ì „ìˆ ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    }

    function loadSquads() {
        ['h', 'a'].forEach(side => {
            const saved = localStorage.getItem(`squad-${side}`);
            if (saved) {
                JSON.parse(saved).forEach(p => {
                    addPlayer(side, p.name, p.pos, parseFloat(p.top), parseFloat(p.left), p.color);
                });
            }
        });
        const pattern = localStorage.getItem('pitch-pattern');
        if (pattern) changePattern(pattern);
    }

    function changePattern(pattern) {
        document.querySelectorAll('.pitch').forEach(p => p.className = 'pitch ' + pattern);
        localStorage.setItem('pitch-pattern', pattern);
    }

    function editPlayer(side) {
        if (!selectedPlayer || selectedPlayer.dataset.side !== side) return alert("ì„ ìˆ˜ë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒí•´ì£¼ì„¸ìš”.");
        const newName = prompt("ì´ë¦„ ìˆ˜ì •:", selectedPlayer.querySelector('.player-name').innerText);
        if (newName) selectedPlayer.querySelector('.player-name').innerText = newName;
    }

    function deletePlayer(side) {
        if (!selectedPlayer || selectedPlayer.dataset.side !== side) return alert("ì„ ìˆ˜ë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒí•´ì£¼ì„¸ìš”.");
        selectedPlayer.remove();
        selectedPlayer = null;
    }

    function clearPitch(side) {
        if(confirm("ëª¨ë“  ì„ ìˆ˜ë¥¼ ì‚­ì œí• ê¹Œìš”?")) {
            document.getElementById(`pitch-${side}`).querySelectorAll('.player').forEach(p => p.remove());
        }
    }

    const forms = {
        '442': [ {p:'GK',t:88,l:42}, {p:'DF',t:72,l:5}, {p:'DF',t:75,l:30}, {p:'DF',t:75,l:55}, {p:'DF',t:72,l:80}, {p:'MF',t:45,l:5}, {p:'MF',t:50,l:30}, {p:'MF',t:50,l:55}, {p:'MF',t:45,l:80}, {p:'FW',t:20,l:30}, {p:'FW',t:20,l:55} ],
        '433': [ {p:'GK',t:88,l:42}, {p:'DF',t:72,l:5}, {p:'DF',t:75,l:30}, {p:'DF',t:75,l:55}, {p:'DF',t:72,l:80}, {p:'MF',t:52,l:15}, {p:'MF',t:58,l:42}, {p:'MF',t:52,l:70}, {p:'FW',t:18,l:10}, {p:'FW',t:12,l:42}, {p:'FW',t:18,l:75} ],
        '4231': [ {p:'GK',t:88,l:42}, {p:'DF',t:72,l:5}, {p:'DF',t:75,l:30}, {p:'DF',t:75,l:55}, {p:'DF',t:72,l:80}, {p:'MF',t:58,l:30}, {p:'MF',t:58,l:55}, {p:'MF',t:35,l:10}, {p:'MF',t:32,l:42}, {p:'MF',t:35,l:75}, {p:'FW',t:12,l:42} ]
    };

    function applyFormation(side, type) {
        document.getElementById(`pitch-${side}`).querySelectorAll('.player').forEach(p => p.remove());
        forms[type].forEach((d, i) => addPlayer(side, `ì„ ìˆ˜ ${i+1}`, d.p, d.t, d.l));
    }

    document.addEventListener('click', () => {
        if (selectedPlayer) { selectedPlayer.classList.remove('selected'); selectedPlayer = null; }
    });
</script>
</body>
</html>