<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í”„ë¡œ ì „ìˆ íŒ - ëª¨ë°”ì¼ ìµœì í™” ì—ë””ì…˜</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root { 
            --pitch-green: #2e7d32; 
            --pitch-dark: #276a2a; 
            --line: rgba(255,255,255,0.6); 
            --select-glow: 0 0 20px 8px #ffeb3b; 
        }
        
        body { font-family: -apple-system, sans-serif; margin: 0; background: #121212; color: white; display: flex; flex-direction: column; align-items: center; overflow-x: hidden; }
        
        /* ìƒë‹¨ í—¤ë” */
        .header { width: 100%; background: #222; padding: 12px; text-align: center; font-weight: bold; border-bottom: 2px solid #333; z-index: 100; }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-layout { display: flex; flex-direction: column; align-items: center; width: 100%; padding: 10px; box-sizing: border-box; }

        /* í”Œë¡œíŒ…/ì ‘ì´ì‹ ì‚¬ì´ë“œë°” (ëª¨ë°”ì¼ í•µì‹¬) */
        .sidebar { 
            position: fixed; top: 0; left: -320px; width: 300px; height: 100%; 
            background: #1a1a1a; z-index: 1000; transition: 0.3s; padding: 20px;
            box-shadow: 5px 0 15px rgba(0,0,0,0.5); overflow-y: auto;
        }
        .sidebar.active { left: 0; }
        
        /* ë©”ë‰´ ì—´ê¸° ë²„íŠ¼ */
        .menu-toggle {
            position: fixed; bottom: 20px; left: 20px; width: 60px; height: 60px;
            background: #1a73e8; border-radius: 50%; display: flex; justify-content: center;
            align-items: center; font-size: 24px; z-index: 1100; cursor: pointer; border: none; color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .box { background: #252525; padding: 15px; border-radius: 12px; border: 1px solid #333; margin-bottom: 15px; }
        h4 { margin: 0 0 12px 0; font-size: 14px; color: #4285f4; }

        /* ê²½ê¸°ì¥ ê·¸ë£¹ */
        .pitch-group { display: flex; flex-direction: column; gap: 30px; width: 100%; align-items: center; }
        .pitch-container { position: relative; background: #252525; padding: 10px 10px 20px 10px; border-radius: 16px; border: 1px solid #333; max-width: 100%; }
        
        .pitch { 
            width: 450px; height: 650px; background-color: var(--pitch-green); 
            background-image: repeating-linear-gradient(0deg, var(--pitch-green), var(--pitch-green) 65px, var(--pitch-dark) 65px, var(--pitch-dark) 130px); 
            position: relative; border: 2.5px solid white; border-radius: 8px; overflow: hidden; touch-action: none; 
        }

        /* ëª¨ë°”ì¼ í™”ë©´ì—ì„œ ê²½ê¸°ì¥ í¬ê¸° ìë™ ì¶•ì†Œ */
        @media (max-width: 480px) {
            .pitch { width: 92vw; height: 135vw; }
        }

        /* ì„ ìˆ˜ ìŠ¤íƒ€ì¼ */
        .player { width: 60px; display: flex; flex-direction: column; align-items: center; cursor: grab; position: absolute; z-index: 100; }
        .player.selected .player-icon { box-shadow: var(--select-glow); border-color: #ffeb3b; transform: scale(1.1); }
        .player-icon { width: 38px; height: 38px; border-radius: 50%; border: 2px solid white; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 11px; color: white; pointer-events: none; }
        .player-name { background: rgba(0,0,0,0.8); color: white; font-size: 10px; padding: 2px 5px; border-radius: 3px; margin-top: 3px; pointer-events: none; }

        /* ì…ë ¥ UI */
        input[type="text"], select, button { padding: 10px; border-radius: 6px; border: 1px solid #444; background: #333; color: white; width: 100%; margin-bottom: 10px; box-sizing: border-box; font-size: 14px; }
        button { cursor: pointer; background: #1a73e8; border: none; font-weight: bold; }

        /* âœ¨ ì™„ë²½í•œ ì •ì‚¬ê°í˜• ì»¬ëŸ¬í”¼ì»¤ */
        .color-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        input[type="color"] { 
            -webkit-appearance: none; border: 1px solid #666; 
            width: 30px; height: 30px; cursor: pointer; background: none; padding: 0; border-radius: 4px; 
        }
        input[type="color"]::-webkit-color-swatch { border: none; }

        .btn-capture { background: #009688 !important; margin-top: 10px; }
        .close-menu { background: #555; margin-top: 10px; }
    </style>
</head>
<body>

<div class="header">âš½ MOBILE TACTIC BOARD</div>

<button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>

<div class="sidebar" id="sidebar">
    <div class="box">
        <h4>ğŸ“‚ ì „ìˆ  ì„¤ì •</h4>
        <select id="targetPitch">
            <option value="pitch-home">ğŸ  HOME TEAM</option>
            <option value="pitch-away">ğŸš© AWAY TEAM</option>
        </select>
        <input type="text" id="squadName" placeholder="ì €ì¥í•  íŒ€ ì´ë¦„">
        <button style="background:#ff9800;" onclick="saveCurrentSquad()">ì „ìˆ  ì €ì¥</button>
        <button style="background:#4285f4;" onclick="toggleModal(true)">ë¼ì´ë¸ŒëŸ¬ë¦¬</button>
    </div>

    <div class="box">
        <h4>ğŸƒ ì„ ìˆ˜ ì¶”ê°€/ìˆ˜ì •</h4>
        <div style="display: flex; gap: 5px;">
            <input type="text" id="pName" placeholder="ì´ë¦„" style="flex: 2;">
            <select id="pPos" style="flex: 1;">
                <option value="FW">FW</option><option value="MF">MF</option>
                <option value="DF">DF</option><option value="GK">GK</option>
            </select>
        </div>
        <div class="color-row">
            <span style="font-size:12px; color:#aaa;">ìœ ë‹ˆí¼ ìƒ‰ìƒ</span>
            <input type="color" id="pColor" value="#1a73e8">
        </div>
        <button onclick="addNewPlayer()">ê²½ê¸°ì¥ì— ì¶”ê°€</button>
        <hr style="border:0; border-top:1px solid #444; margin:15px 0;">
        <input type="text" id="editName" placeholder="ì´ë¦„ ìˆ˜ì •">
        <div style="display: flex; gap: 5px;">
            <button style="background:#673ab7;" onclick="changePlayerName()">ìˆ˜ì •</button>
            <button style="background:#d93025;" onclick="deleteSelectedPlayer()">ì‚­ì œ</button>
        </div>
    </div>

    <div class="box">
        <h4>ğŸ“‹ í¬ë©”ì´ì…˜</h4>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px;">
            <button style="background:#34a853;" onclick="applyFormation('442')">4-4-2</button>
            <button style="background:#34a853;" onclick="applyFormation('433')">4-3-3</button>
        </div>
    </div>
    
    <button class="close-menu" onclick="toggleSidebar()">ë‹«ê¸°</button>
</div>

<div class="main-layout">
    <div class="pitch-group">
        <div class="pitch-area">
            <h3 style="text-align:center; color:#4285f4; margin-top:0;">HOME</h3>
            <div id="capture-home" class="pitch-container">
                <div id="pitch-home" class="pitch">
                    <div style="position:absolute; width:100%; top:50%; border-top:2px solid var(--line); pointer-events:none;"></div>
                </div>
            </div>
            <button class="btn-capture" onclick="saveIndividualImage('capture-home', 'home_tactic')">ğŸ“¸ í™ˆ ì´ë¯¸ì§€ ì €ì¥</button>
        </div>

        <div class="pitch-area">
            <h3 style="text-align:center; color:#ea4335; margin-top:0;">AWAY</h3>
            <div id="capture-away" class="pitch-container">
                <div id="pitch-away" class="pitch">
                    <div style="position:absolute; width:100%; top:50%; border-top:2px solid var(--line); pointer-events:none;"></div>
                </div>
            </div>
            <button class="btn-capture" onclick="saveIndividualImage('capture-away', 'away_tactic')">ğŸ“¸ ì–´ì›¨ì´ ì´ë¯¸ì§€ ì €ì¥</button>
        </div>
    </div>
</div>

<script>
    // ì‚¬ì´ë“œë°” í† ê¸€ ê¸°ëŠ¥
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('active');
    }

    // --- ê¸°ì¡´ ë¡œì§ 100% ë™ì¼ ìœ ì§€ ---
    let selectedPlayer = null;
    function getActivePitch() { return document.getElementById(document.getElementById('targetPitch').value); }
    
    document.addEventListener('pointerdown', (e) => {
        if (!e.target.closest('.player') && !e.target.closest('.box') && !e.target.closest('.sidebar')) {
            if (selectedPlayer) selectedPlayer.classList.remove('selected');
            selectedPlayer = null;
        }
    });

    function addNewPlayer() {
        const name = document.getElementById('pName').value || "ì„ ìˆ˜";
        const pos = document.getElementById('pPos').value;
        const color = document.getElementById('pColor').value;
        createPlayerElement(name, pos, color, '45%', '45%', getActivePitch());
        document.getElementById('pName').value = '';
        if(window.innerWidth < 768) toggleSidebar(); // ëª¨ë°”ì¼ì´ë©´ ì¶”ê°€í›„ ë‹«ê¸°
    }

    function createPlayerElement(name, pos, color, x, y, target) {
        const p = document.createElement('div');
        p.className = 'player';
        p.style.left = x; p.style.top = y;
        p.innerHTML = `<div class="player-icon" style="background:${color}">${pos}</div><div class="player-name">${name}</div>`;
        target.appendChild(p);
        initDrag(p, target);
        return p;
    }

    function initDrag(el, pitchRef) {
        let isDragging = false, startX, startY, origX, origY;
        el.onpointerdown = (e) => {
            if (selectedPlayer) selectedPlayer.classList.remove('selected');
            selectedPlayer = el; el.classList.add('selected');
            isDragging = true; el.setPointerCapture(e.pointerId);
            const rect = el.getBoundingClientRect();
            startX = e.clientX - rect.left; startY = e.clientY - rect.top;
            origX = el.style.left; origY = el.style.top;
        };
        el.onpointermove = (e) => {
            if (!isDragging) return;
            const pRect = pitchRef.getBoundingClientRect();
            let x = e.clientX - pRect.left - startX;
            let y = e.clientY - pRect.top - startY;
            el.style.left = Math.max(0, Math.min(x, pRect.width - 50)) + 'px';
            el.style.top = Math.max(0, Math.min(y, pRect.height - 60)) + 'px';
        };
        el.onpointerup = (e) => {
            if (!isDragging) return;
            isDragging = false; el.releasePointerCapture(e.pointerId);
            const targets = document.elementsFromPoint(e.clientX, e.clientY);
            let targetPlayer = null;
            for (const t of targets) {
                const found = t.closest('.player');
                if (found && found !== el && found.parentElement === pitchRef) {
                    targetPlayer = found; break;
                }
            }
            if (targetPlayer) {
                const tx = targetPlayer.style.left; const ty = targetPlayer.style.top;
                targetPlayer.style.left = origX; targetPlayer.style.top = origY;
                el.style.left = tx; el.style.top = ty;
            }
        };
    }

    function saveIndividualImage(id, name) {
        html2canvas(document.getElementById(id)).then(canvas => {
            const link = document.createElement('a');
            link.download = name + '.png'; link.href = canvas.toDataURL(); link.click();
        });
    }

    const formations = {
        '442': [{p:'GK',t:'85%',l:'44%'}, {p:'DF',t:'70%',l:'8%'}, {p:'DF',t:'72%',l:'32%'}, {p:'DF',t:'72%',l:'56%'}, {p:'DF',t:'70%',l:'80%'}, {p:'MF',t:'45%',l:'8%'}, {p:'MF',t:'48%',l:'32%'}, {p:'MF',t:'48%',l:'56%'}, {p:'MF',t:'45%',l:'80%'}, {p:'FW',t:'15%',l:'32%'}, {p:'FW',t:'15%',l:'56%'}],
        '433': [{p:'GK',t:'85%',l:'44%'}, {p:'DF',t:'70%',l:'8%'}, {p:'DF',t:'72%',l:'32%'}, {p:'DF',t:'72%',l:'56%'}, {p:'DF',t:'70%',l:'80%'}, {p:'MF',t:'50%',l:'22%'}, {p:'MF',t:'55%',l:'44%'}, {p:'MF',t:'50%',l:'66%'}, {p:'FW',t:'15%',l:'12%'}, {p:'FW',t:'10%',l:'44%'}, {p:'FW',t:'15%',l:'76%'}]
    };
    function applyFormation(t) {
        const target = getActivePitch();
        target.querySelectorAll('.player').forEach(p => p.remove());
        formations[t].forEach((pos, i) => createPlayerElement(`ì„ ìˆ˜ ${i+1}`, pos.p, document.getElementById('pColor').value, pos.l, pos.t, target));
    }
</script>
</body>
</html>
