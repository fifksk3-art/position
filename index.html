<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í”„ë¡œ ì „ìˆ íŒ - í•˜ì´ì—”ë“œ ë°¸ëŸ°ìŠ¤ ì—ë””ì…˜</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root { 
            --pitch-green: #2e7d32; 
            --pitch-dark: #276a2a; 
            --line: rgba(255,255,255,0.6); 
            --select-glow: 0 0 20px 8px #ffeb3b; 
            /* ì „ì²´ ë†’ì´ ê³„ì‚°: 700(ë³´ë“œ) + 15(ìƒë‹¨íŒ¨ë”©) + 40(í•˜ë‹¨íŒ¨ë”©) + 2(í…Œë‘ë¦¬) = 757px */
            --total-height: 757px;
        }
        
        body { font-family: -apple-system, sans-serif; margin: 0; background: #121212; color: white; display: flex; flex-direction: column; align-items: center; }
        .header { width: 100%; background: #222; padding: 15px; text-align: center; font-weight: bold; border-bottom: 2px solid #333; margin-bottom: 20px; }
        
        .main-layout { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            padding: 0 20px 40px 20px; 
            width: fit-content;
            align-items: flex-start; /* ìƒë‹¨ ì •ë ¬ */
        }
        
        /* ì‚¬ì´ë“œë°” ë†’ì´ë¥¼ ì „ìˆ ë³´ë“œì™€ ë™ì¼í•˜ê²Œ ê³ ì • */
        .sidebar { 
            width: 320px; 
            height: var(--total-height); 
            display: flex; 
            flex-direction: column; 
            justify-content: space-between; /* ë°•ìŠ¤ë“¤ì„ ìœ„ì•„ë˜ë¡œ ê· ë“± ë¶„ì‚° */
            box-sizing: border-box;
        }

        .box { background: #252525; padding: 15px; border-radius: 12px; border: 1px solid #333; }

        /* íŒì—… ëª¨ë‹¬ */
        .modal-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 1000; justify-content: center; align-items: center; 
        }
        .modal-content { 
            background: #252525; width: 90%; max-width: 450px; border-radius: 16px; 
            border: 1px solid #444; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .modal-close { cursor: pointer; font-size: 24px; color: #aaa; }
        
        #squad-list-container { max-height: 400px; overflow-y: auto; }
        .squad-item { 
            display: flex; justify-content: space-between; align-items: center; 
            background: #333; padding: 12px 15px; margin-bottom: 8px; border-radius: 8px; 
        }

        /* ê²½ê¸°ì¥ ì˜ì—­ */
        .pitch-area { display: flex; flex-direction: column; align-items: center; }
        .pitch-container { 
            position: relative; 
            background: #252525; 
            padding: 15px 15px 40px 15px; 
            border-radius: 16px; 
            border: 1px solid #333;
            box-sizing: border-box;
        }
        .pitch { 
            width: 500px; 
            height: 700px; 
            background-color: var(--pitch-green); 
            background-image: repeating-linear-gradient(0deg, var(--pitch-green), var(--pitch-green) 70px, var(--pitch-dark) 70px, var(--pitch-dark) 140px);
            position: relative; border: 3px solid white; border-radius: 8px; overflow: hidden; touch-action: none; 
        }

        .player { width: 65px; display: flex; flex-direction: column; align-items: center; cursor: grab; position: absolute; z-index: 100; }
        .player.selected .player-icon { box-shadow: var(--select-glow); border-color: #ffeb3b; transform: scale(1.15); }
        .player-icon { width: 44px; height: 44px; border-radius: 50%; border: 2.5px solid white; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 13px; color: white; pointer-events: none; }
        .player-name { background: rgba(0,0,0,0.85); color: white; font-size: 11px; padding: 3px 8px; border-radius: 4px; margin-top: 5px; white-space: nowrap; pointer-events: none; }
        
        input[type="color"] { -webkit-appearance: none; border: none; width: 20px; height: 20px; cursor: pointer; background: none; padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: 1px solid white; border-radius: 50%; }

        input[type="text"], select, button { padding: 10px; border-radius: 6px; border: 1px solid #444; background: #333; color: white; width: 100%; margin-bottom: 8px; box-sizing: border-box; font-size: 14px; }
        button { cursor: pointer; background: #1a73e8; border: none; font-weight: bold; }

        .control-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 10px; }
        .btn-save { background: #009688 !important; margin-bottom: 0 !important; }
        .btn-reset { background: #555 !important; margin-bottom: 0 !important; }
        .btn-view-list { background: #4285f4; margin-top: 5px; margin-bottom: 0; }
        h4 { margin: 0 0 10px 0; font-size: 15px; }
    </style>
</head>
<body>

<div class="header">ğŸŸï¸ PRO TACTIC BOARD - PERFECT BALANCE</div>

<div class="main-layout">
    <div class="sidebar">
        <div class="box">
            <h4>ğŸ“‚ ìŠ¤ì¿¼ë“œ ì €ì¥ì†Œ</h4>
            <input type="text" id="squadName" placeholder="íŒ€ ì´ë¦„ ì…ë ¥">
            <button style="background:#ff9800;" onclick="saveCurrentSquad()">í˜„ì¬ ìŠ¤ì¿¼ë“œ ì €ì¥</button>
            <button class="btn-view-list" onclick="toggleModal(true)">ì €ì¥ëœ ìŠ¤ì¿¼ë“œ ë³´ê¸°</button>
        </div>

        <div class="box">
            <h4>âœï¸ ì„ ìˆ˜ ì´ë¦„ ë³€ê²½</h4>
            <input type="text" id="editName" placeholder="ìƒˆ ì´ë¦„ ì…ë ¥">
            <button style="background:#673ab7;" onclick="changePlayerName()">ì´ë¦„ ë³€ê²½ ì ìš©</button>
        </div>

        <div class="box">
            <h4>ğŸƒ ì„ ìˆ˜ ë“±ë¡</h4>
            <input type="text" id="pName" placeholder="ì„ ìˆ˜ ì´ë¦„">
            <select id="pPos">
                <option value="FW">FW</option><option value="MF">MF</option>
                <option value="DF">DF</option><option value="GK">GK</option>
            </select>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-size:13px; color:#aaa;">ìœ ë‹ˆí¼ ìƒ‰ìƒ</span>
                <input type="color" id="pColor" value="#1a73e8">
            </div>
            <button onclick="addNewPlayer()">ê²½ê¸°ì¥ì— ì¶”ê°€</button>
            <button style="background:#d93025; margin-bottom: 0;" onclick="deleteSelectedPlayer()">ì„ íƒí•œ ì„ ìˆ˜ ì‚­ì œ</button>
        </div>

        <div class="box">
            <h4>ğŸ“‹ ë¹ ë¥¸ í¬ë©”ì´ì…˜</h4>
            <div style="display:flex; gap:5px;">
                <button style="background:#34a853; margin-bottom: 0;" onclick="applyFormation('442')">442</button>
                <button style="background:#34a853; margin-bottom: 0;" onclick="applyFormation('433')">433</button>
                <button style="background:#34a853; margin-bottom: 0;" onclick="applyFormation('4231')">4231</button>
            </div>
        </div>

        <div class="box">
            <h4>ğŸ® ì‹œìŠ¤í…œ ì»¨íŠ¸ë¡¤</h4>
            <div class="control-grid">
                <button class="btn-save" onclick="saveAsImage()">ğŸ“¸ ì´ë¯¸ì§€ ì €ì¥</button>
                <button class="btn-reset" onclick="resetPitch()">ğŸ”„ ë¦¬ì…‹</button>
            </div>
        </div>
    </div>

    <div class="pitch-area">
        <div id="capture-area" class="pitch-container">
            <div id="pitch" class="pitch">
                <div style="position:absolute; width:100%; top:50%; border-top:2px solid var(--line); pointer-events:none;"></div>
                <div style="position:absolute; width:120px; height:120px; border:2px solid var(--line); border-radius:50%; top:50%; left:50%; transform:translate(-50%,-50%); pointer-events:none;"></div>
                <div style="position:absolute; width:200px; height:80px; border:2px solid var(--line); top:0; left:50%; transform:translateX(-50%); pointer-events:none;"></div>
                <div style="position:absolute; width:200px; height:80px; border:2px solid var(--line); bottom:0; left:50%; transform:translateX(-50%); pointer-events:none;"></div>
            </div>
        </div>
    </div>
</div>

<div id="squadModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 style="margin:0;">ğŸ“š ì „ìˆ  ë¼ì´ë¸ŒëŸ¬ë¦¬</h3>
            <span class="modal-close" onclick="toggleModal(false)">&times;</span>
        </div>
        <div id="squad-list-container"></div>
    </div>
</div>

<script>
    const pitch = document.getElementById('pitch');
    let selectedPlayer = null;

    function toggleModal(show) {
        document.getElementById('squadModal').style.display = show ? 'flex' : 'none';
        if(show) renderSquadList();
    }

    document.addEventListener('pointerdown', (e) => {
        if (!e.target.closest('.player') && !e.target.closest('.box') && !e.target.closest('.modal-content')) {
            if (selectedPlayer) selectedPlayer.classList.remove('selected');
            selectedPlayer = null;
        }
    });

    function resetPitch() {
        if (confirm('ê²½ê¸°ì¥ì˜ ëª¨ë“  ì„ ìˆ˜ë¥¼ ì‚­ì œí• ê¹Œìš”?')) {
            pitch.querySelectorAll('.player').forEach(p => p.remove());
            selectedPlayer = null;
        }
    }

    function changePlayerName() {
        const newName = document.getElementById('editName').value;
        if (!selectedPlayer) return alert("ì„ ìˆ˜ë¥¼ í´ë¦­í•˜ì„¸ìš”!");
        if (!newName) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");
        selectedPlayer.querySelector('.player-name').innerText = newName;
        document.getElementById('editName').value = '';
    }

    function deleteSelectedPlayer() {
        if (selectedPlayer) { selectedPlayer.remove(); selectedPlayer = null; }
        else alert("ì„ ìˆ˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”!");
    }

    function addNewPlayer() {
        const name = document.getElementById('pName').value || "ì„ ìˆ˜";
        const pos = document.getElementById('pPos').value;
        const color = document.getElementById('pColor').value;
        createPlayerElement(name, pos, color, '45%', '45%');
        document.getElementById('pName').value = '';
    }

    function createPlayerElement(name, pos, color, x, y) {
        const p = document.createElement('div');
        p.className = 'player';
        p.style.left = x; p.style.top = y;
        p.innerHTML = `<div class="player-icon" style="background:${color}">${pos}</div><div class="player-name">${name}</div>`;
        pitch.appendChild(p);
        initDrag(p);
        return p;
    }

    function initDrag(el) {
        let isDragging = false, startX, startY, origX, origY;
        el.onpointerdown = (e) => {
            if (selectedPlayer) selectedPlayer.classList.remove('selected');
            selectedPlayer = el; el.classList.add('selected');
            isDragging = true; el.setPointerCapture(e.pointerId);
            const rect = el.getBoundingClientRect();
            startX = e.clientX - rect.left; startY = e.clientY - rect.top;
            origX = el.style.left; origY = el.style.top;
        };
        el.onpointermove = (e) => {
            if (!isDragging) return;
            const pRect = pitch.getBoundingClientRect();
            let x = e.clientX - pRect.left - startX;
            let y = e.clientY - pRect.top - startY;
            x = Math.max(-10, Math.min(x, pRect.width - 55));
            y = Math.max(-10, Math.min(y, pRect.height - 65));
            el.style.left = x + 'px'; el.style.top = y + 'px';
        };
        el.onpointerup = (e) => {
            if (!isDragging) return;
            isDragging = false;
            let targetPlayer = null;
            document.querySelectorAll('.player').forEach(other => {
                if (other === el) return;
                const oRect = other.getBoundingClientRect();
                if (e.clientX > oRect.left && e.clientX < oRect.right && e.clientY > oRect.top && e.clientY < oRect.bottom) targetPlayer = other;
            });
            if (targetPlayer) {
                const tx = targetPlayer.style.left; const ty = targetPlayer.style.top;
                targetPlayer.style.left = origX; targetPlayer.style.top = origY;
                el.style.left = tx; el.style.top = ty;
            }
        };
    }

    const formations = {
        '442': [{p:'GK',t:'85%',l:'44%'}, {p:'DF',t:'70%',l:'8%'}, {p:'DF',t:'72%',l:'32%'}, {p:'DF',t:'72%',l:'56%'}, {p:'DF',t:'70%',l:'80%'}, {p:'MF',t:'45%',l:'8%'}, {p:'MF',t:'48%',l:'32%'}, {p:'MF',t:'48%',l:'56%'}, {p:'MF',t:'45%',l:'80%'}, {p:'FW',t:'15%',l:'32%'}, {p:'FW',t:'15%',l:'56%'}],
        '433': [{p:'GK',t:'85%',l:'44%'}, {p:'DF',t:'70%',l:'8%'}, {p:'DF',t:'72%',l:'32%'}, {p:'DF',t:'72%',l:'56%'}, {p:'DF',t:'70%',l:'80%'}, {p:'MF',t:'50%',l:'22%'}, {p:'MF',t:'55%',l:'44%'}, {p:'MF',t:'50%',l:'66%'}, {p:'FW',t:'15%',l:'12%'}, {p:'FW',t:'10%',l:'44%'}, {p:'FW',t:'15%',l:'76%'}],
        '4231': [{p:'GK',t:'85%',l:'44%'}, {p:'DF',t:'70%',l:'8%'}, {p:'DF',t:'72%',l:'32%'}, {p:'DF',t:'72%',l:'56%'}, {p:'DF',t:'70%',l:'80%'}, {p:'MF',t:'60%',l:'32%'}, {p:'MF',t:'60%',l:'56%'}, {p:'MF',t:'35%',l:'10%'}, {p:'MF',t:'30%',l:'44%'}, {p:'MF',t:'35%',l:'78%'}, {p:'FW',t:'10%',l:'44%'}]
    };

    function applyFormation(type) {
        const chosenColor = document.getElementById('pColor').value;
        pitch.querySelectorAll('.player').forEach(p => p.remove());
        formations[type].forEach((pos, i) => createPlayerElement(`ì„ ìˆ˜ ${i+1}`, pos.p, chosenColor, pos.l, pos.t));
        selectedPlayer = null;
    }

    function saveCurrentSquad() {
        const sName = document.getElementById('squadName').value;
        if (!sName) return alert("íŒ€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");
        const players = Array.from(document.querySelectorAll('.player')).map(p => ({
            name: p.querySelector('.player-name').innerText,
            pos: p.querySelector('.player-icon').innerText,
            color: p.querySelector('.player-icon').style.backgroundColor,
            left: p.style.left, top: p.style.top
        }));
        const allSquads = JSON.parse(localStorage.getItem('my_squads_final_vMaster') || '{}');
        allSquads[sName] = players;
        localStorage.setItem('my_squads_final_vMaster', JSON.stringify(allSquads));
        document.getElementById('squadName').value = '';
        alert("ìŠ¤ì¿¼ë“œê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    function renderSquadList() {
        const listDiv = document.getElementById('squad-list-container');
        listDiv.innerHTML = '';
        const allSquads = JSON.parse(localStorage.getItem('my_squads_final_vMaster') || '{}');
        Object.keys(allSquads).forEach(name => {
            const item = document.createElement('div');
            item.className = 'squad-item';
            item.innerHTML = `<span>${name}</span><div style="display:flex; gap:5px;"><button style="background:#1a73e8; width:60px;" onclick="loadSquad('${name}')">ì—´ê¸°</button><button style="background:#d93025; width:40px;" onclick="deleteSquad('${name}')">X</button></div>`;
            listDiv.appendChild(item);
        });
    }

    function loadSquad(name) {
        const allSquads = JSON.parse(localStorage.getItem('my_squads_final_vMaster') || '{}');
        const squad = allSquads[name];
        pitch.querySelectorAll('.player').forEach(p => p.remove());
        squad.forEach(p => createPlayerElement(p.name, p.pos, p.color, p.left, p.top));
        selectedPlayer = null; toggleModal(false);
    }

    function deleteSquad(name) {
        if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            const allSquads = JSON.parse(localStorage.getItem('my_squads_final_vMaster') || '{}');
            delete allSquads[name];
            localStorage.setItem('my_squads_final_vMaster', JSON.stringify(allSquads));
            renderSquadList();
        }
    }

    function saveAsImage() {
        html2canvas(document.getElementById('capture-area')).then(canvas => {
            const link = document.createElement('a');
            link.download = 'tactic_board.png'; link.href = canvas.toDataURL(); link.click();
        });
    }
</script>
</body>
</html>
